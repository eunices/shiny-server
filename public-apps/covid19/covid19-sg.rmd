---
title: "COVID 19 Singapore"
output:
  html_document:
    toc: true
    theme: united
---

## Getting data

```{r}
library(rvest)
library(ggplot2)
source('main.r')

url = "https://co.vid19.sg/cases/search"
df = get_data(url)
```

Data is obtained from `r url`. 

## Cleaning data

```{r}
df = clean_data(df)
```

## EDA

### Histogram of N days till recovery
```{r}
theme = theme_minimal()
binwidth = 5
min = as.numeric(min(df$days.to.recover.resources, na.rm=T))
max = as.numeric(max(df$days.to.recover.resources, na.rm=T))
data = as.numeric(df$days.to.recover.resources)
data = data.frame(cat=cut(data, breaks=seq(min, max, by=binwidth), right = FALSE),
                  val=data)
hist_max = max(table(data$cat))

ggplot(df, aes(x=days.to.recover.resources)) + geom_histogram(binwidth=binwidth, na.rm=T) + 
  xlab("Days to recover") + ylab("Number of people") +
  scale_y_continuous(breaks=seq(0, hist_max, ifelse(hist_max <30, 1, 5))) +
  theme

# Number of recovered
print(table(!is.na(df$days.to.recover.resources)))

# Distribution of days it takes to recover
print(table(data$cat))

# Median and mean number of days it takes to recover
print(median(df$days.to.recover.resources, na.rm=T))
print(mean(df$days.to.recover.resources, na.rm=T))

```

### Correlation between age and days to recover
```{r}

ggplot(df, aes(x=age, y=days.to.recover.resources)) + geom_point() + 
  xlab("Age") + ylab("Days to recover") +
  theme

df_corr = df[!is.na(df$days.to.recover.resources),]
print("Rsq:")
print(cor(as.numeric(df_corr$age), as.numeric(df_corr$days.to.recover.resources))^2)

```

### Boxplot between age brackets and days to recover
```{r}
theme = theme_minimal()
agewidth = 10
min = as.numeric(min(df$age, na.rm=T))
max = as.numeric(max(df$age, na.rm=T))
data = data.frame(cat=cut(as.numeric(df$age), breaks=seq(0, max, by=agewidth), right = FALSE),
                  age=df$age, 
                  days=df$days.to.recover.resources)

ggplot(data, aes(x=cat, y=days)) + geom_boxplot() +
  geom_jitter(height = 0, width = 0.1) +
  xlab("Age category") + ylab("Days to recover") + theme

```